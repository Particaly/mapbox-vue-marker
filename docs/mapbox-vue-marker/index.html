<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>介绍 | mapbox-vue-marker</title>
    <meta name="description" content="插件文档">
    <link rel="stylesheet" href="/mapbox-vue-marker/main.css">
    
    <link rel="preload" href="/mapbox-vue-marker/assets/css/0.styles.fbce77cd.css" as="style"><link rel="preload" href="/mapbox-vue-marker/assets/js/app.b812a892.js" as="script"><link rel="preload" href="/mapbox-vue-marker/assets/js/2.59f736d3.js" as="script"><link rel="preload" href="/mapbox-vue-marker/assets/js/7.3f854d1e.js" as="script"><link rel="prefetch" href="/mapbox-vue-marker/assets/js/3.36f51179.js"><link rel="prefetch" href="/mapbox-vue-marker/assets/js/4.1f06765c.js"><link rel="prefetch" href="/mapbox-vue-marker/assets/js/5.0b82fbb8.js"><link rel="prefetch" href="/mapbox-vue-marker/assets/js/6.a49325be.js"><link rel="prefetch" href="/mapbox-vue-marker/assets/js/8.f155e301.js">
    <link rel="stylesheet" href="/mapbox-vue-marker/assets/css/0.styles.fbce77cd.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/mapbox-vue-marker/" class="home-link router-link-active"><!----> <span class="site-name">mapbox-vue-marker</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/mapbox-vue-marker/" class="nav-link">主页</a></div><div class="nav-item"><a href="/mapbox-vue-marker/mapbox-vue-marker/" class="nav-link router-link-exact-active router-link-active">开发文档</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/mapbox-vue-marker/" class="nav-link">主页</a></div><div class="nav-item"><a href="/mapbox-vue-marker/mapbox-vue-marker/" class="nav-link router-link-exact-active router-link-active">开发文档</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>介绍</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/mapbox-vue-marker/mapbox-vue-marker/#介绍" class="sidebar-link">介绍</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/mapbox-vue-marker/mapbox-vue-marker/#安装" class="sidebar-link">安装</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/mapbox-vue-marker/mapbox-vue-marker/#注册组件" class="sidebar-link">注册组件</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/mapbox-vue-marker/mapbox-vue-marker/#重命名插件方法" class="sidebar-link">重命名插件方法</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/mapbox-vue-marker/mapbox-vue-marker/#makemarker-创建marker" class="sidebar-link">$makeMarker 创建marker</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/mapbox-vue-marker/mapbox-vue-marker/#addmarker-添加marker到地图" class="sidebar-link">$addMarker 添加marker到地图</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/mapbox-vue-marker/mapbox-vue-marker/#removemarker-移除marker" class="sidebar-link">$removeMarker 移除marker</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/mapbox-vue-marker/mapbox-vue-marker/#getmarkerbox-数据存储" class="sidebar-link">$getMarkerBox 数据存储</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/mapbox-vue-marker/mapbox-vue-marker/#行为分析" class="sidebar-link">行为分析</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="介绍"><a href="#介绍" aria-hidden="true" class="header-anchor">#</a> 介绍</h2> <p>最初的灵感来源于，能否实现动态创建一个 vue 组件，并添加到页面上显示出来。</p> <p>后来开发地图场景，需要使用 mapbox 的 marker 做地图扎点，而 mapbox 的扎点实际使用的是 dom ，如此一来便萌生了能否使用 vue 来做扎点的想法。</p> <p>在经历几个版本的迭代后，迎来了 mapbox-vue-marker 的诞生！</p> <p>使用Mapbox-Vue-Marker，你可以通过 vue 组件的方式，向地图添加扎点marker，实现完全由数据驱动的UI逻辑，工欲善其事必先利其器，方能事半功倍！</p> <h2 id="安装"><a href="#安装" aria-hidden="true" class="header-anchor">#</a> 安装</h2> <div class="language- extra-class"><pre class="language-text"><code>npm install mapbox-vue-marker --save
</code></pre></div><p>目前仅支持通过 npm 安装</p> <p>注意！本插件需要同时使用vue和mapboxgl</p> <p>国内建议使用 cnpm 进行安装</p> <div class="language- extra-class"><pre class="language-text"><code>cnpm install mapbox-vue-marker --save
</code></pre></div><h2 id="注册组件"><a href="#注册组件" aria-hidden="true" class="header-anchor">#</a> 注册组件</h2> <p>通过 npm 安装之后，需要在 main.js 注册该插件</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">'./store'</span>
<span class="token keyword">import</span> mapboxgl <span class="token keyword">from</span> <span class="token string">'mapbox-gl'</span>
<span class="token keyword">import</span> <span class="token string">'mapbox-gl/dist/mapbox-gl.css'</span>
<span class="token keyword">import</span> mapboxvuemarker <span class="token keyword">from</span> <span class="token string">'mapbox-vue-marker'</span>

<span class="token keyword">let</span> plugOptions <span class="token operator">=</span> <span class="token punctuation">{</span>
  mapboxgl<span class="token punctuation">,</span>router<span class="token punctuation">,</span>store<span class="token punctuation">,</span>
  <span class="token comment">// 可通过rename修改默认的方法名</span>
  <span class="token comment">// rename:{</span>
  <span class="token comment">//   '$addMarker':'addMK',</span>
  <span class="token comment">//   '$removeMarker':'delMk',</span>
  <span class="token comment">//   '$makeMarker':'makeMK'</span>
  <span class="token comment">// }</span>
<span class="token punctuation">}</span>

Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>mapboxvuemarker<span class="token punctuation">,</span>plugOptions<span class="token punctuation">)</span>

Vue<span class="token punctuation">.</span>config<span class="token punctuation">.</span>productionTip <span class="token operator">=</span> <span class="token boolean">false</span>

<span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  router<span class="token punctuation">,</span>
  store<span class="token punctuation">,</span>
  <span class="token function-variable function">render</span><span class="token punctuation">:</span> <span class="token parameter">h</span> <span class="token operator">=&gt;</span> <span class="token function">h</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">提示</p> <p>router和store是可选参数</p></div> <p>通过 Vue 提供的use方法注册该组件，传入插件对象和配置对象</p> <p>配置对象的参数如下</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>options <span class="token operator">=</span> <span class="token punctuation">{</span>
    mapboxgl<span class="token punctuation">,</span>	<span class="token comment">//mapboxgl对象（必须）</span>
    router<span class="token punctuation">,</span>		<span class="token comment">//vue的router（可选）</span>
    store<span class="token punctuation">,</span>		<span class="token comment">//vuex对象（可选）</span>
<span class="token punctuation">}</span>
</code></pre></div><p>到此插件的配置就完成了！</p> <h2 id="重命名插件方法"><a href="#重命名插件方法" aria-hidden="true" class="header-anchor">#</a> 重命名插件方法</h2> <p>我们向 Vue 的原型链上添加了三个基础方法，为了排除命名冲突的问题，我们提供了修改命名的方法</p> <p>插件在 main.js 中注册的时候，可传递一个 rename 字段，该字段的值必须是一个对象。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> plugOptions <span class="token operator">=</span> <span class="token punctuation">{</span>
  mapboxgl<span class="token punctuation">,</span>router<span class="token punctuation">,</span>store<span class="token punctuation">,</span>
  rename<span class="token punctuation">:</span><span class="token punctuation">{</span>
    <span class="token string">'$addMarker'</span><span class="token punctuation">:</span><span class="token string">'addMK'</span><span class="token punctuation">,</span>
    <span class="token string">'$removeMarker'</span><span class="token punctuation">:</span><span class="token string">'delMk'</span><span class="token punctuation">,</span>
    <span class="token string">'$makeMarker'</span><span class="token punctuation">:</span><span class="token string">'makeMK'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>mapboxvuemarker<span class="token punctuation">,</span>plugOptions<span class="token punctuation">)</span>
</code></pre></div><p>上述代码可以看出，键名为要修改的方法，键值为修改的结果</p> <h2 id="makemarker-创建marker"><a href="#makemarker-创建marker" aria-hidden="true" class="header-anchor">#</a> $makeMarker 创建marker</h2> <p>在配置好环境以后，我们正式开始创建marker，以下是一个创建marker的小例子
首先我们创建一个基本的 vue 组件</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>vuemarker<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>V<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
        name<span class="token punctuation">:</span> <span class="token string">&quot;vuemarker&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>现在我们把这个 vue 组件导出</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>mapboxgl<span class="token punctuation">.</span>accessToken <span class="token operator">=</span> <span class="token string">'token'</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mapboxgl<span class="token punctuation">.</span>Map</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	container<span class="token punctuation">:</span> <span class="token string">'map'</span><span class="token punctuation">,</span>
    style<span class="token punctuation">:</span> <span class="token string">'mapbox://styles/mapbox/streets-v11'</span><span class="token punctuation">,</span> 
    center<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">74.50</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    zoom<span class="token punctuation">:</span> <span class="token number">9</span> 
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> marker <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$makeMarker</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    lnglat<span class="token punctuation">:</span>map<span class="token punctuation">.</span><span class="token function">getCenter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    component<span class="token punctuation">:</span>vuemarker<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>上述代码创建了一个最基本的mapbox地图，然后通过插件的全局方法 $makeMarker 方法创建了一个marker对象，并赋值给 marker 变量</p> <div class="tip custom-block"><p class="custom-block-title">提示</p> <p>$makeMarker方法接受一个配置对象，返回标准的mapbox的marker对象</p></div> <p>$makeMarker的详细配置参数有：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
	lnglat<span class="token punctuation">,</span><span class="token comment">//marker在地图上的经纬度（必须）</span>
	component<span class="token punctuation">,</span><span class="token comment">//组成marker的 vue 组件</span>
	anchor<span class="token punctuation">,</span><span class="token comment">//marker的中心点，详情见mapbox官网介绍，默认为bottom</span>
	props<span class="token punctuation">,</span><span class="token comment">//vue组件接收的参数对象，默认为空对象</span>
	draggable<span class="token punctuation">,</span><span class="token comment">//marker是否可拖动，默认为false</span>
	zIndex<span class="token punctuation">,</span><span class="token comment">//扎点的层级，默认为空</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="warning custom-block"><p class="custom-block-title">注意</p> <p>$makeMarker的作用仅仅是创建marker</p></div> <h2 id="addmarker-添加marker到地图"><a href="#addmarker-添加marker到地图" aria-hidden="true" class="header-anchor">#</a> $addMarker 添加marker到地图</h2> <p>此时还需要调用$addMarker方法来添加marker到地图</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$addMarker</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>marker<span class="token punctuation">,</span>map<span class="token punctuation">)</span>
</code></pre></div><p>$addMarker的两个参数都为必填项，第一个参数可以是marker对象，也可以是包含marker的数组或对象，第二个参数为map对象</p> <p>方法内部会遍历参数对象的所有深度，移除参数对象包含的所有marker</p> <div class="warning custom-block"><p class="custom-block-title">注意</p> <p>只有那些通过$makeMarker方法制造的marker才能被该方法添加到地图</p></div> <h2 id="removemarker-移除marker"><a href="#removemarker-移除marker" aria-hidden="true" class="header-anchor">#</a> $removeMarker 移除marker</h2> <p>$removeMarker方法可以移除在地图上的marker</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$removeMarker</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>marker<span class="token punctuation">)</span>
</code></pre></div><p>该方法需要一个参数，即要移除的marker，和添加的方法相同，这个参数也可以是一个包含marker的数组或对象</p> <div class="warning custom-block"><p class="custom-block-title">注意</p> <p>只有那些通过$makeMarker方法制造的marker才能被该方法从地图移除</p></div> <h2 id="getmarkerbox-数据存储"><a href="#getmarkerbox-数据存储" aria-hidden="true" class="header-anchor">#</a> $getMarkerBox 数据存储</h2> <div class="danger custom-block"><p class="custom-block-title">一定要注意</p> <p>🙃如果没有开启markerBox，千万不要将marker放入vue组件的data中</p> <p>🙃这会导致vue向marker对象设置无效的getter和setter</p> <p>🙃您可能会需要手动实现marker的存储，并在beforeDestroy钩子中销毁</p></div> <p>在实际项目中，更多可能的是会面临多种类多数量的marker</p> <p>在此提供一种保存数据的想法</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> markerbox <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getMarkerBox</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>如果需要插件来代理存储marker，您需要在调用$makeMarker方法时传入参数usebox（boolean）和markerType（string）</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> markerbox<span class="token operator">=</span><span class="token punctuation">{</span>
    type1<span class="token punctuation">:</span><span class="token punctuation">[</span>marker<span class="token punctuation">]</span><span class="token punctuation">,</span>
    other<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>传入的类型会被存储为markerbox对象下的数组</p> <div class="tip custom-block"><p class="custom-block-title">提示</p> <p>开启usebox功能后，如果没有传入markerType，那么这个marker将被归类到other分类下</p></div> <h2 id="行为分析"><a href="#行为分析" aria-hidden="true" class="header-anchor">#</a> 行为分析</h2> <div class="tip custom-block"><p class="custom-block-title">标准对象</p> <p>$addMarker 和 $removeMarker 仅对与通过 $makeMarker 方法构建的marker生效</p></div> <div class="tip custom-block"><p class="custom-block-title">vue-marker组件默认行为</p> <p>$makeMarker 构造完毕后，会立刻执行 vue 组件的 mounted 方法，并且将一直处于挂载状态</p> <p>考虑到业务中的逻辑，我们提供了 $addMarker 和 $removeMarker 的回调方法，您可以在 vue 组件的 methods 中提供 onAdd 和 onRemove 方法，它们将作为回调方法自动调用</p></div> <div class="tip custom-block"><p class="custom-block-title">marker层级</p> <p>我们默认接管了 marker 的层级关系，它在每次拖动地图时，都会进行计算并更新层级参数</p> <p>您可以在构建 marker 时传入 zIndex 来设置为固定层级</p></div> <div class="tip custom-block"><p class="custom-block-title">参数传递</p> <p>我们默认向 vue 组件提供了两个 props ，分别是 marker 对象和 parent 对象，parent 指向调用构造 marker 方法的 vue 实例</p></div> <div class="tip custom-block"><p class="custom-block-title">marker对象默认行为</p> <p>mapbox 的 marker 也具有默认行为，当您调用 $addMarker 的时候，它将首先调用一次 remove方法，您需要注意调用回调时，可能产生不可预知的错误</p></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/mapbox-vue-marker/assets/js/app.b812a892.js" defer></script><script src="/mapbox-vue-marker/assets/js/2.59f736d3.js" defer></script><script src="/mapbox-vue-marker/assets/js/7.3f854d1e.js" defer></script>
  </body>
</html>
